<!DOCTYPE html>
<html lang="en">
<head>
          <link rel="icon" type="image/png" href="sultana pictures/WhatsApp Image 2025-09-11 at 18.38.45_80dff706.png">
    <!-- Optional for Apple/Android homescreens -->
    <link rel="apple-touch-icon" href="sultana pictures/WhatsApp Image 2025-09-11 at 18.38.45_80dff706.png">

    <!-- üîç Google Structured Data (shows logo in search results) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://www.sultanahaircare.com",
      "logo": "https://www.olyshair.com/sultana pictures/WhatsApp Image 2025-09-11 at 18.38.45_80dff706.png"
    }
    </script>
  <meta charset="UTF-8" />
  <title>Shop | Princesse Sultana Hair Care</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --golden-brown: #B76E22;
      --dark-brown: #8B4513;
      --light-gold: #D4AF37;
      --cream: #FFF8E7;
      --groovy-orange: #FF8C42;
      --groovy-pink: #FF6B6B;
      --deep-green: #2E8B57;
      --off-white: #FDF6E3;
      --black: #333333;
      --light-brown: #d3bfa3;
      --golden-light: #F5E6CA;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Poppins', system-ui, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--black);
      background-color: var(--cream);
      overflow-x: hidden;
    }
    .bg-fallback {
      position: fixed;
      inset: 0;
      z-index: -3;
      pointer-events: none;
      background: 
        radial-gradient(circle at 20% 30%, rgba(214, 175, 55, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 80% 70%, rgba(183, 110, 34, 0.1) 0%, transparent 20%);
    }
    
    /* Enhanced Navigation Bar */
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      padding: 12px 5%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, var(--golden-brown) 0%, var(--dark-brown) 100%);
      color: white;
      box-shadow: 0 5px 20px rgba(139, 69, 19, 0.4);
      border-bottom: 3px solid var(--light-gold);
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      letter-spacing: .5px;
      color: var(--light-gold);
      font-size: 26px;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
    }
    
    .brand i {
      font-size: 28px;
      filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.3));
    }
    
    nav ul {
      list-style: none;
      display: flex;
      gap: 25px;
      align-items: center;
    }
    
    nav a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s ease;
      padding: 8px 12px;
      border-radius: 8px;
      position: relative;
    }
    
    nav a:hover {
      color: var(--light-gold);
      background: rgba(255, 255, 255, 0.1);
    }
    
    nav a.active {
      color: var(--light-gold);
      background: rgba(255, 255, 255, 0.15);
    }
    
    nav a::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 50%;
      width: 0;
      height: 2px;
      background: var(--light-gold);
      transition: all 0.3s ease;
      transform: translateX(-50%);
    }
    
    nav a:hover::after, nav a.active::after {
      width: 80%;
    }
    
    .cart-icon {
      position: relative;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
    .cart-icon:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .cart-count {
      position: absolute;
      top: -5px;
      right: 0;
      background: var(--groovy-pink);
      color: white;
      font-size: 0.7rem;
      font-weight: bold;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .stage {
      max-width: 1200px;
      margin: 60px auto 40px;
      padding: 0 20px;
    }
    
    .page-title {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .page-title h1 {
      font-size: 2.8rem;
      color: var(--dark-brown);
      margin-bottom: 10px;
      position: relative;
      display: inline-block;
    }
    
    .page-title h1::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 3px;
      background: linear-gradient(90deg, var(--golden-brown), var(--light-gold));
      border-radius: 3px;
    }
    
    .page-title p {
      font-size: 1.1rem;
      color: var(--black);
      opacity: 0.8;
      max-width: 600px;
      margin: 0 auto;
    }
    
    .slider {
      position: relative;
      overflow: hidden;
      border-radius: 24px;
      background: white;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 1px solid var(--light-brown);
    }
    
    .track {
      display: flex;
      transition: transform .6s cubic-bezier(.22, .61, .36, 1);
    }
    
    .slide {
      min-width: 100%;
      display: grid;
      grid-template-columns: 1fr 1fr;
      align-items: stretch;
    }
    
    .media {
      position: relative;
      overflow: hidden;
      background: var(--off-white);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .media img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1.02);
      transition: transform .6s ease;
    }
    
    .slide:hover .media img {
      transform: scale(2.06);
    }
    
    .image-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--light-brown);
      color: var(--dark-brown);
      font-size: 3rem;
    }
    
    .glow {
      position: absolute;
      inset: auto auto 20px 20px;
      width: 180px;
      height: 180px;
      filter: blur(40px);
      background: radial-gradient(closest-side, rgba(255, 215, 0, 0.35), transparent 70%);
      pointer-events: none;
    }
    
    .content {
      padding: 36px 32px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 16px;
    }
    
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(255, 215, 0, 0.15);
      border: 1px solid rgba(139, 69, 19, 0.2);
      width: max-content;
      font-size: .85rem;
      color: var(--dark-brown);
    }
    
    h2 {
      font-size: 2rem;
      color: var(--dark-brown);
    }
    
    .desc {
      opacity: .95;
      line-height: 1.7;
      color: var(--black);
    }
    
    .price {
      font-weight: 800;
      font-size: 1.25rem;
      color: var(--golden-brown);
    }
    
    .buy-row {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 4px;
    }
    
    .qty {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid var(--light-brown);
      border-radius: 12px;
      padding: 8px 10px;
    }
    
    .qty input {
      width: 56px;
      background: transparent;
      border: none;
      color: var(--black);
      text-align: center;
      font-weight: 600;
      outline: none;
      font-size: 1rem;
    }
    
    .qty button {
      width: 28px;
      height: 28px;
      border-radius: 10px;
      border: 1px solid var(--light-brown);
      background: var(--cream);
      color: var(--dark-brown);
      cursor: pointer;
      font-weight: bold;
    }
    
    .cta {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 18px;
      border-radius: 14px;
      cursor: pointer;
      border: none;
      font-weight: 700;
      background: linear-gradient(135deg, var(--golden-brown) 0%, var(--dark-brown) 100%);
      color: white;
      box-shadow: 0 6px 18px rgba(139, 69, 19, 0.3);
      transition: transform .15s ease, box-shadow .2s ease;
    }
    
    .cta:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 26px rgba(139, 69, 19, 0.4);
    }
    
    .cta-buy-now {
      background: linear-gradient(135deg, var(--deep-green) 0%, #1e6b3f 100%);
      box-shadow: 0 6px 18px rgba(46, 139, 87, 0.3);
    }
    
    .cta-buy-now:hover {
      box-shadow: 0 10px 26px rgba(46, 139, 87, 0.4);
    }
    
    .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 44px;
      height: 44px;
      display: grid;
      place-items: center;
      border-radius: 50%;
      border: 1px solid var(--light-brown);
      background: white;
      color: var(--dark-brown);
      cursor: pointer;
      z-index: 2;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: background .2s ease, color .2s ease;
    }
    
    .arrow:hover {
      background: var(--golden-brown);
      color: white;
    }
    
    .prev { left: 14px; }
    .next { right: 14px; }
    
    .dots {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 16px 0 22px;
    }
    
    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(139, 69, 19, 0.3);
      cursor: pointer;
      border: 1px solid rgba(139, 69, 19, 0.5);
      transition: transform .2s ease, background .2s ease;
    }
    
    .dot.active {
      background: var(--golden-brown);
      transform: scale(1.15);
    }
    
    .toast {
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 20;
      background: var(--dark-brown);
      color: white;
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid var(--light-gold);
      opacity: 0;
      transform: translateY(12px);
      transition: opacity .25s ease, transform .25s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    /* Sliding Cart Styles */
    .cart-preview {
      position: fixed;
      top: 0;
      right: -400px;
      width: 380px;
      height: 100vh;
      background: white;
      box-shadow: -5px 0 25px rgba(0, 0, 0, 0.15);
      z-index: 200;
      transition: right 0.4s cubic-bezier(0.22, 0.61, 0.36, 1);
      display: flex;
      flex-direction: column;
    }
    
    .cart-preview.open {
      right: 0;
    }
    
    .cart-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 199;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .cart-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .cart-header {
      padding: 20px;
      background: linear-gradient(135deg, var(--golden-brown) 0%, var(--dark-brown) 100%);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .cart-header h3 {
      margin: 0;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .close-cart {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    .close-cart:hover {
      transform: scale(1.1);
    }
    
    .cart-items {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
    }
    
    .cart-item-preview {
      display: flex;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid #eee;
    }
    
    .cart-item-preview:last-child {
      border-bottom: none;
    }
    
    .cart-item-image {
      width: 70px;
      height: 70px;
      border-radius: 8px;
      overflow: hidden;
      flex-shrink: 0;
    }
    
    .cart-item-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .cart-item-details {
      flex: 1;
    }
    
    .cart-item-name {
      font-weight: 600;
      color: var(--dark-brown);
      margin-bottom: 5px;
      font-size: 0.95rem;
    }
    
    .cart-item-price {
      color: var(--golden-brown);
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .cart-item-qty {
      font-size: 0.85rem;
      color: var(--black);
      opacity: 0.7;
    }
    
    .cart-footer {
      padding: 20px;
      border-top: 1px solid #eee;
      background: var(--off-white);
    }
    
    .cart-total {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--dark-brown);
    }
    
    .cart-actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .btn-view-cart {
      background: var(--light-gold);
      color: var(--dark-brown);
    }
    
    .btn-checkout {
      background: linear-gradient(135deg, var(--deep-green) 0%, #1e6b3f 100%);
    }
    
    footer {
      margin-top: 50px;
      background: linear-gradient(135deg, var(--dark-brown) 0%, var(--black) 100%);
      color: white;
      padding: 40px 8% 20px;
    }
    
    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 30px;
    }
    
    footer h3, footer h4 {
      color: var(--light-gold);
      margin-bottom: 12px;
    }
    
    footer ul {
      list-style: none;
      padding: 0;
    }
    
    footer ul li {
      margin: 6px 0;
    }
    
    footer ul li a {
      color: white;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    
    footer ul li a:hover {
      color: var(--light-gold);
    }
    
    .socials a {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      width: 34px;
      height: 34px;
      margin-right: 10px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      transition: all 0.3s ease;
    }
    
    .socials a:hover {
      background: var(--light-gold);
      color: var(--dark-brown);
    }
    
    .footer-bottom {
      text-align: center;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 20px;
      padding-top: 15px;
      font-size: 0.9rem;
      color: #ccc;
    }
    
    /* Bulk Product Styling */
    .bulk-info {
      margin-top: 15px;
      padding: 15px;
      background: rgba(183, 110, 34, 0.05);
      border-radius: 10px;
      border-left: 3px solid var(--golden-brown);
    }
    
    .bulk-info h3 {
      color: var(--dark-brown);
      font-size: 1.1rem;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .bulk-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    
    .bulk-item {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .bulk-label {
      font-size: 0.85rem;
      color: var(--gray);
      font-weight: 500;
    }
    
    .bulk-value {
      font-weight: 600;
      color: var(--dark-brown);
    }
    
    .bulk-price {
      color: var(--golden-brown);
      font-weight: 700;
    }
    
    .bulk-status {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .status-available {
      background: rgba(46, 139, 87, 0.1);
      color: var(--deep-green);
    }
    
    .status-low-stock {
      background: rgba(255, 193, 7, 0.1);
      color: #856404;
    }
    
    .status-out-of-stock {
      background: rgba(220, 53, 69, 0.1);
      color: var(--red);
    }
    
    /* Purchase Type Selection */
    .purchase-type {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    
    .purchase-option {
      padding: 8px 16px;
      border: 1px solid var(--light-brown);
      border-radius: 8px;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    
    .purchase-option.active {
      background: var(--golden-brown);
      color: white;
      border-color: var(--golden-brown);
    }
    
    @media (max-width: 900px) {
      .slide {
        grid-template-columns: 1fr;
      }
      .media { height: 320px; }
      .content { padding: 26px 22px; }
      h2 { font-size: 1.6rem; }
      .bulk-details {
        grid-template-columns: 1fr;
      }
      .cart-preview {
        width: 320px;
      }
      nav ul {
        gap: 15px;
      }
    }
    
    @media (max-width: 768px) {
      .brand {
        font-size: 22px;
      }
      .brand i {
        font-size: 24px;
      }
      .page-title h1 {
        font-size: 2.2rem;
      }
      .cart-preview {
        width: 300px;
      }
    }
    /* Company Logo Styles */
.company-logo {
  position: absolute;
  right: 20px;
  top: 50%;
  transform: translateY(-50%);
  z-index: 101;
}

.logo-image {
  height: 50px;
  width: auto;
  max-width: 120px;
  object-fit: contain;
  border-radius: 8px;
  transition: transform 0.3s ease;
  border: 2px solid var(--light-gold);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.logo-image:hover {
  transform: scale(1.05);
}

/* Adjust navigation for logo */
nav ul {
  margin-right: 140px; /* Space for the logo */
}

/* Responsive adjustments */
@media (max-width: 900px) {
  .company-logo {
    position: static;
    transform: none;
    margin-left: auto;
    margin-right: 15px;
  }
  
  .logo-image {
    height: 40px;
  }
  
  nav ul {
    margin-right: 0;
  }
  
  header {
    flex-wrap: wrap;
    gap: 10px;
  }
}

@media (max-width: 768px) {
  .company-logo {
    order: 2;
    margin-left: auto;
  }
  
  nav {
    order: 3;
    width: 100%;
  }
  
  nav ul {
    justify-content: center;
    margin-top: 10px;
  }
  
  .logo-image {
    height: 35px;
  }
}
  </style>
</head>
<body>
  <div class="bg-fallback" aria-hidden="true"></div>
  
  <!-- Enhanced Navigation Bar -->
<header>
  <div class="brand"><i class="fas fa-spa"></i> Princesse Sultana Beauty</div>
  
  <!-- Company Logo on the Right Side -->
  <div class="company-logo">
    <img src="sultana pictures/WhatsApp Image 2025-09-11 at 18.38.45_80dff706.png" alt="Princesse Sultana Logo" class="logo-image">
  </div>
  
  <nav>
    <ul>
      <li><a href="index.html" class="active">Home</a></li>
       <li><a href="user dashboard.html">profile</a></li>
      <!-- <li><a href="shop.html" class="active">Shop</a></li> -->
      <li><a href="how-to-use.html">About</a></li>
      <li><a href="Order Management.html">Orders</a></li>
      <li class="cart-icon" id="cartIcon">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count" id="cartCount">0</span>
      </li>
    </ul>
  </nav>
</header>
  
  <!-- Sliding Cart Preview -->
  <div class="cart-overlay" id="cartOverlay"></div>
  <div class="cart-preview" id="cartPreview">
    <div class="cart-header">
      <h3><i class="fas fa-shopping-cart"></i> Your Cart</h3>
      <button class="close-cart" id="closeCart">&times;</button>
    </div>
    <div class="cart-items" id="cartPreviewItems">
      <!-- Cart items will be dynamically inserted here -->
      <div class="empty-cart-message" id="emptyCartMessage">
        <p>Your cart is empty</p>
        <p>Add some products to get started!</p>
      </div>
    </div>
    <div class="cart-footer">
      <div class="cart-total">
        <span>Total:</span>
        <span id="cartPreviewTotal">0 XAF</span>
      </div>
      <div class="cart-actions">
        <a href="shopping Cart.html" class="cta btn-view-cart" style="text-align: center; text-decoration: none;">
          <i class="fas fa-shopping-bag"></i> View Full Cart
        </a>
        <button class="cta btn-checkout" id="checkoutBtn">
          <i class="fas fa-credit-card"></i> Checkout Now
        </button>
      </div>
    </div>
  </div>
  
  <!-- Main Content -->
  <main class="stage">
    <div class="page-title">
      <h1>Our Premium Collection</h1>
      <p>Discover our 100% natural hair care solutions made with love and tradition</p>
    </div>
    
    <section class="slider" id="slider">
      <button class="arrow prev" aria-label="Previous"><i class="fas fa-chevron-left"></i></button>
      <div class="track" id="track"></div>
      <button class="arrow next" aria-label="Next"><i class="fas fa-chevron-right"></i></button>
    </section>
    <div class="dots" id="dots"></div>
  </main>
  
  <div class="toast" id="toast"></div>

  <footer>
    <div class="footer-content">
      <div class="col">
        <h3>Princesse Sultana Hair Care</h3>
        <p>100% natural hair care solutions made with love and tradition.</p>
      </div>
      <div class="col">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="shop.html">Shop</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </div>
      <div class="col">
        <h4>Follow Us</h4>
        <div class="socials">
          <a href="#"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-whatsapp"></i></a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2023 Princesse Sultana Hair Care | All Rights Reserved</p>
    </div>
  </footer>


<script>
  // Add these utility functions at the top of the script in index.html:
function isLoggedIn() {
    const token = localStorage.getItem('token');
    const user = localStorage.getItem('user');
    return !!(token && user);
}

function getUser() {
    try {
        return JSON.parse(localStorage.getItem('user') || '{}');
    } catch {
        return {};
    }
}

function requireAuth(redirectTo) {
    if (!isLoggedIn()) {
        // Save current URL for redirect after login
        if (redirectTo) {
            localStorage.setItem('redirectAfterLogin', redirectTo);
        }
        window.location.href = 'login.html?redirect=cart';
        return false;
    }
    return true;
}

  
    // Enhanced Cart Functions with Bulk Support
    function getCart() {
        try { 
            return JSON.parse(localStorage.getItem('cart') || '[]'); 
        } catch { 
            return []; 
        }
    }
    
    function setCart(c) { 
        localStorage.setItem('cart', JSON.stringify(c)); 
    }

    function addToCart(item) {
        const cart = getCart();
        
        // Create a unique identifier that includes purchase type
        const uniqueId = `${item.id}-${item.purchaseType}`;
        
        const existingItem = cart.find(p => 
            p.uniqueId === uniqueId && p.purchaseType === item.purchaseType
        );
        
        if (existingItem) {
            existingItem.qty += item.qty;
        } else {
            cart.push({
                uniqueId: uniqueId,
                id: item.id,
                name: item.name,
                price: parseFloat(item.price),
                qty: item.qty,
                image: item.image || '',
                purchaseType: item.purchaseType || 'retail',
                isBulk: item.isBulk || false,
                bulkUnit: item.bulkUnit || '',
                unitDescription: item.unitDescription || 'unit(s)'
            });
        }
        
        setCart(cart);
        updateCartStorage();
        updateCartPreview();
        updateCartCount();
    }

    function updateCartStorage() {
        const cart = getCart();
        localStorage.setItem('cartItems', JSON.stringify(cart));
        
        const subtotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
        const shipping = 1000;
        const total = subtotal + shipping;
        
        localStorage.setItem('cartSubtotal', subtotal);
        localStorage.setItem('cartShipping', shipping);
        localStorage.setItem('cartTotal', total);
        localStorage.setItem('cartCurrency', 'XAF');
    }

    // Update cart count in navigation
    function updateCartCount() {
        const cart = getCart();
        const totalItems = cart.reduce((sum, item) => sum + item.qty, 0);
        document.getElementById('cartCount').textContent = totalItems;
    }

    // Update cart preview
    function updateCartPreview() {
        const cart = getCart();
        const container = document.getElementById('cartPreviewItems');
        const emptyMessage = document.getElementById('emptyCartMessage');
        const totalElement = document.getElementById('cartPreviewTotal');
        
        if (cart.length === 0) {
            emptyMessage.style.display = 'block';
            container.innerHTML = '';
            container.appendChild(emptyMessage);
            totalElement.textContent = '0 XAF';
            return;
        }
        
        emptyMessage.style.display = 'none';
        
        let total = 0;
        container.innerHTML = '';
        
        cart.forEach(item => {
            const itemTotal = item.price * item.qty;
            total += itemTotal;
            
            const cartItem = document.createElement('div');
            cartItem.className = 'cart-item-preview';
            cartItem.innerHTML = `
                <div class="cart-item-image">
                    <img src="${item.image || 'https://images.unsplash.com/photo-1608248543803-ba4f8c70ae0b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'}" alt="${item.name}">
                </div>
                <div class="cart-item-details">
                    <div class="cart-item-name">${item.name}</div>
                    <div class="cart-item-price">${item.price.toLocaleString()} XAF</div>
                    <div class="cart-item-qty">${item.qty} ${item.unitDescription} ‚Ä¢ ${item.isBulk ? 'Bulk' : 'Single'}</div>
                </div>
            `;
            container.appendChild(cartItem);
        });
        
        totalElement.textContent = `${total.toLocaleString()} XAF`;
    }

    // Cart preview functionality
    document.getElementById('cartIcon').addEventListener('click', function() {
        document.getElementById('cartPreview').classList.add('open');
        document.getElementById('cartOverlay').classList.add('active');
        updateCartPreview();
    });

    document.getElementById('closeCart').addEventListener('click', function() {
        document.getElementById('cartPreview').classList.remove('open');
        document.getElementById('cartOverlay').classList.remove('active');
    });

    document.getElementById('cartOverlay').addEventListener('click', function() {
        document.getElementById('cartPreview').classList.remove('open');
        document.getElementById('cartOverlay').classList.remove('active');
    });

    // Checkout functionality
document.getElementById('checkoutBtn').addEventListener('click', function() {
    const cart = getCart();
    if (cart.length === 0) {
        showToast('Your cart is empty!');
        return;
    }
    
    // Check if user is logged in
    if (!requireAuth('cart')) {
        // Save cart temporarily
        localStorage.setItem('pendingCart', JSON.stringify(cart));
        showToast('Please login or register to proceed to checkout');
        return;
    }
    
    // Redirect to checkout page
    window.location.href = 'shopping Cart.html';
});
    // Admin check
    function isAdmin() {
        const token = localStorage.getItem('adminToken');
        if (!token) return false;
        
        try {
            const user = JSON.parse(localStorage.getItem('adminUser') || '{}');
            return user.role === 'admin';
        } catch {
            return false;
        }
    }

    // Fetch products from backend
    async function fetchProducts() {
        try {
            console.log('üõçÔ∏è Fetching products...');
            
            // Try multiple endpoints
            const endpoints = [
                'https://princess-sultana-beauty-shop-online.onrender.com/api/products',
                'https://princess-sultana-beauty-shop-online.onrender.com/api/products-debug'
            ];
            
            let products = [];
            let lastError = null;
            
            for (const endpoint of endpoints) {
                try {
                    console.log(`üîç Trying endpoint: ${endpoint}`);
                    const res = await fetch(endpoint);
                    
                    if (!res.ok) {
                        throw new Error(`HTTP ${res.status}`);
                    }
                    
                    products = await res.json();
                    console.log(`‚úÖ Success from ${endpoint}, products:`, products.length);
                    
                    if (products && products.length > 0) break;
                } catch (error) {
                    console.error(`‚ùå Failed from ${endpoint}:`, error.message);
                    lastError = error;
                    continue;
                }
            }
            
            if (products.length === 0 && lastError) {
                throw lastError;
            }
            
            // Transform products to handle image fields
            return products.map(product => {
                // Handle multiple image fields
                let imageUrl = product.imageURL;
                
                // If no imageURL, use first image from images array
                if (!imageUrl && product.images && product.images.length > 0) {
                    imageUrl = product.images[0].url;
                }
                
                // If still no image, use a placeholder
                if (!imageUrl) {
                    imageUrl = 'https://images.unsplash.com/photo-1608248543803-ba4f8c70ae0b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80';
                }
                
                return {
                    ...product,
                    imageURL: imageUrl,
                    image: imageUrl // Add both fields for compatibility
                };
            });
            
        } catch (error) {
            console.error('‚ùå Error fetching products:', error);
            showToast('Failed to load products: ' + error.message);
            return [];
        }
    }

    // Debug function to check product structure
    function debugProduct(product) {
        console.log('üîç Product Debug:', {
            id: product._id,
            name: product.name,
            price: product.price,
            retailPrice: product.retailPrice,
            wholesalePrice: product.wholesalePrice,
            bulkPrice: product.bulkPrice,
            bulkQuantity: product.bulkQuantity,
            bulkUnit: product.bulkUnit,
            images: product.images
        });
    }

    // Render products with proper image handling and bulk support
    async function renderProducts() {
        const products = await fetchProducts();
        const track = document.getElementById('track');
        
        if (products.length === 0) {
            track.innerHTML = `
                <div class="slide">
                    <div class="content" style="grid-column: 1 / -1; text-align: center;">
                        <h2>No Products Available</h2>
                        <p>Check back later for our amazing hair care products!</p>
                    </div>
                </div>
            `;
            renderDots();
            return;
        }
        
        track.innerHTML = '';
        
        products.forEach(product => {
            // Debug product data
            debugProduct(product);
            
            // Handle multiple possible image fields
            let imageUrl = product.imageURL || product.image;
            if (!imageUrl && product.images && product.images.length > 0) {
                imageUrl = product.images[0].url;
            }
            // Final fallback to placeholder
            if (!imageUrl) {
                imageUrl = 'https://images.unsplash.com/photo-1608248543803-ba4f8c70ae0b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80';
            }
            if (imageUrl.startsWith('/uploads/')) {
                imageUrl = `http://localhost:5000${imageUrl}`;
            }

            const imageHtml = `
                <img src="${imageUrl}" 
                    alt="${product.name}" 
                    onerror="handleImageError(this)"
                    loading="lazy" 
                    style="width: 100%; height: 100%; object-fit: cover;" />
                <div class="image-placeholder" style="display: none;">
                    <i class="fas fa-cube"></i>
                </div>
            `;

            // Determine bulk status
            let bulkStatus = 'status-available';
            let bulkStatusText = 'Available';
            if (product.bulkQuantity <= 0) {
                bulkStatus = 'status-out-of-stock';
                bulkStatusText = 'Out of Stock';
            } else if (product.bulkQuantity < 5) {
                bulkStatus = 'status-low-stock';
                bulkStatusText = 'Low Stock';
            }

            // Get prices from admin settings - FIXED VERSION
            const retailPriceValue = product.retailPrice || product.price || 0;
            
            // Use wholesalePrice if available, otherwise use bulkPrice, otherwise calculate 20% off
            const bulkPriceValue = product.wholesalePrice || product.bulkPrice || (retailPriceValue * 0.8).toFixed(0);

            // Build bulk info HTML if available
            const bulkInfoHtml = product.bulkQuantity > 0 ? `
                <div class="bulk-info">
                    <h3><i class="fas fa-boxes"></i> Bulk Purchase Available</h3>
                    <div class="bulk-details">
                        <div class="bulk-item">
                            <span class="bulk-label">Bulk Price</span>
                            <span class="bulk-value bulk-price">${bulkPriceValue} XAF</span>
                        </div>
                        <div class="bulk-item">
                            <span class="bulk-label">Unit Size</span>
                            <span class="bulk-value">${product.bulkUnit || 'Standard Package'}</span>
                        </div>
                        <div class="bulk-item">
                            <span class="bulk-label">Available</span>
                            <span class="bulk-value">${product.bulkQuantity} packages</span>
                        </div>
                        <div class="bulk-item">
                            <span class="bulk-label">Status</span>
                            <span class="bulk-status ${bulkStatus}">${bulkStatusText}</span>
                        </div>
                        ${product.wholesalePrice ? `
                        <div class="bulk-item">
                            <span class="bulk-label">Savings</span>
                            <span class="bulk-value" style="color: var(--deep-green);">
                                ${calculateSavingsPercentage(retailPriceValue, bulkPriceValue)}% OFF
                            </span>
                        </div>
                        ` : ''}
                    </div>
                </div>
            ` : '';

            const slide = document.createElement('article');
            slide.className = 'slide';
            slide.innerHTML = `
                <figure class="media">
                    ${imageHtml}
                    <span class="glow"></span>
                </figure>
                <div class="content">
                    <span class="pill"><i class="fa-solid fa-star"></i> ${product.tag || 'Premium'}</span>
                    <h2>${product.name}</h2>
                    <p class="desc">${product.description || 'No description available.'}</p>
                    
                    <!-- Purchase Type Selection -->
                    <div class="purchase-type">
                        <div class="purchase-option active" data-type="retail">
                            <i class="fas fa-shopping-bag"></i> Retail
                        </div>
                        ${product.bulkQuantity > 0 ? `
                            <div class="purchase-option" data-type="bulk">
                                <i class="fas fa-boxes"></i> Bulk
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- Retail Price (default) -->
                    <div class="price retail-price">${retailPriceValue} XAF</div>
                    
                    <!-- Bulk Price (hidden by default) -->
                    ${product.bulkQuantity > 0 ? `
                        <div class="price bulk-price" style="display: none;">${bulkPriceValue} XAF</div>
                    ` : ''}
                    
                    ${bulkInfoHtml}
                    
                    <div class="buy-row">
                        <div class="qty">
                            <button type="button" data-dec>-</button>
                            <input type="number" min="1" value="1">
                            <button type="button" data-inc>+</button>
                        </div>
                        <button class="cta" data-buy 
                                data-id="${product._id}" 
                                data-name="${product.name}" 
                                data-retail-price="${retailPriceValue}"
                                data-bulk-price="${bulkPriceValue}"
                                data-image="${imageUrl || ''}"
                                data-bulk-unit="${product.bulkUnit || ''}">
                            <i class="fa-solid fa-bag-shopping"></i> Add to Cart
                        </button>
                        <button class="cta cta-buy-now" data-buy-now 
                                data-id="${product._id}" 
                                data-name="${product.name}" 
                                data-retail-price="${retailPriceValue}"
                                data-bulk-price="${bulkPriceValue}"
                                data-image="${imageUrl || ''}"
                                data-bulk-unit="${product.bulkUnit || ''}">
                            <i class="fas fa-bolt"></i> Buy Now
                        </button>
                        ${isAdmin() ? `
                            <button class="cta" data-remove data-id="${product._id}" style="background:#FF6B6B;">
                                <i class="fas fa-trash"></i> Remove
                            </button>
                        ` : ''}
                    </div>
                    ${isAdmin() ? `
                        <button class="cta" data-add style="background:#2E8B57;">
                            <i class="fas fa-plus"></i> Add New Product
                        </button>
                    ` : ''}
                </div>
            `;
            track.appendChild(slide);
        });

        setupSlideEvents();
        renderDots();
        updateCartCount();
    }

    // Calculate savings percentage for bulk purchases
    function calculateSavingsPercentage(retailPrice, bulkPrice) {
        if (!retailPrice || !bulkPrice || retailPrice <= bulkPrice) return 0;
        const savings = ((retailPrice - bulkPrice) / retailPrice) * 100;
        return Math.round(savings);
    }

    // Enhanced Setup slide events with bulk purchase support
    function setupSlideEvents() {
        document.querySelectorAll('.slide').forEach(slide => {
            const dec = slide.querySelector('[data-dec]');
            const inc = slide.querySelector('[data-inc]');
            const input = slide.querySelector('input[type="number"]');
            const purchaseOptions = slide.querySelectorAll('.purchase-option');
            const retailPrice = slide.querySelector('.retail-price');
            const bulkPrice = slide.querySelector('.bulk-price');
            const buyBtn = slide.querySelector('[data-buy]');
            const buyNowBtn = slide.querySelector('[data-buy-now]');
            
            // Enhanced purchase type selection
            purchaseOptions.forEach(option => {
                option.addEventListener('click', () => {
                    purchaseOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    
                    const purchaseType = option.getAttribute('data-type');
                    
                    // Update buy button data attributes
                    if (purchaseType === 'retail') {
                        retailPrice.style.display = 'block';
                        if (bulkPrice) bulkPrice.style.display = 'none';
                        buyBtn.dataset.price = buyBtn.dataset.retailPrice;
                        buyBtn.dataset.purchaseType = 'retail';
                        buyNowBtn.dataset.price = buyNowBtn.dataset.retailPrice;
                        buyNowBtn.dataset.purchaseType = 'retail';
                    } else {
                        retailPrice.style.display = 'none';
                        if (bulkPrice) bulkPrice.style.display = 'block';
                        buyBtn.dataset.price = buyBtn.dataset.bulkPrice;
                        buyBtn.dataset.purchaseType = 'bulk';
                        buyNowBtn.dataset.price = buyNowBtn.dataset.bulkPrice;
                        buyNowBtn.dataset.purchaseType = 'bulk';
                        
                        // For bulk purchases, set minimum quantity to 1 unit (which is 1 bulk package)
                        input.value = 1;
                        input.min = 1;
                    }
                });
            });
            
            // Quantity decrease button
            dec.addEventListener('click', () => { 
                input.value = Math.max(1, (+input.value || 1) - 1); 
            });
            
            // Quantity increase button
            inc.addEventListener('click', () => { 
                input.value = (+input.value || 1) + 1; 
            });
            
            // Enhanced buy button click handler
            buyBtn.addEventListener('click', () => {
                const activePurchaseType = slide.querySelector('.purchase-option.active').getAttribute('data-type');
                let qty = Math.max(1, parseInt(input.value || '1', 10));
                let price, unitDescription = '';
                
                if (activePurchaseType === 'retail') {
                    price = parseFloat(buyBtn.dataset.retailPrice);
                    unitDescription = 'unit(s)';
                } else {
                    price = parseFloat(buyBtn.dataset.bulkPrice);
                    unitDescription = buyBtn.dataset.bulkUnit || 'package(s)';
                    // For bulk purchases, quantity represents number of bulk packages
                    qty = Math.max(1, qty); // Minimum 1 bulk package
                }

                const item = {
                    id: buyBtn.dataset.id,
                    name: buyBtn.dataset.name,
                    price: price,
                    qty: qty,
                    image: buyBtn.dataset.image || '',
                    purchaseType: activePurchaseType,
                    unitDescription: unitDescription,
                    isBulk: activePurchaseType === 'bulk',
                    bulkUnit: activePurchaseType === 'bulk' ? buyBtn.dataset.bulkUnit : ''
                };
                
                addToCart(item);
                showToast(`${item.name} √ó${item.qty} ${unitDescription} (${activePurchaseType}) added to cart`);
            });
            
            // Buy Now button click handler
buyNowBtn.addEventListener('click', () => {
    const activePurchaseType = slide.querySelector('.purchase-option.active').getAttribute('data-type');
    let qty = Math.max(1, parseInt(input.value || '1', 10));
    let price, unitDescription = '';
    
    if (activePurchaseType === 'retail') {
        price = parseFloat(buyNowBtn.dataset.retailPrice);
        unitDescription = 'unit(s)';
    } else {
        price = parseFloat(buyNowBtn.dataset.bulkPrice);
        unitDescription = buyNowBtn.dataset.bulkUnit || 'package(s)';
        qty = Math.max(1, qty);
    }

    const item = {
        id: buyNowBtn.dataset.id,
        name: buyNowBtn.dataset.name,
        price: price,
        qty: qty,
        image: buyNowBtn.dataset.image || '',
        purchaseType: activePurchaseType,
        unitDescription: unitDescription,
        isBulk: activePurchaseType === 'bulk',
        bulkUnit: activePurchaseType === 'bulk' ? buyNowBtn.dataset.bulkUnit : ''
    };
                // Clear cart and add only this item
               // Check if user is logged in before proceeding
    if (!requireAuth('cart')) {
        // Save this single item as pending cart
        localStorage.setItem('pendingCart', JSON.stringify([item]));
        showToast('Please login or register to complete your purchase');
        return;
    }
    
    // Clear cart and add only this item
    setCart([item]);
    updateCartStorage();
    updateCartCount();
    showToast(`${item.name} √ó${item.qty} ${unitDescription} (${activePurchaseType}) added to cart`);
    
    // Redirect to checkout
    window.location.href = 'shopping Cart.html';
});
            
            // Admin remove functionality
            const remove = slide.querySelector('[data-remove]');
            if (remove) {
                remove.addEventListener('click', async () => {
                    if (confirm('Are you sure you want to remove this product?')) {
                        try {
                            const token = localStorage.getItem('adminToken');
                            const response = await fetch(`https://princess-sultana-beauty-shop-online.onrender.com/api/admin/products/${remove.dataset.id}`, { 
                                method: 'DELETE',
                                headers: {
                                    'Authorization': `Bearer ${token}`
                                }
                            });
                            
                            if (response.ok) {
                                showToast('Product removed successfully');
                                renderProducts();
                            } else {
                                showToast('Failed to remove product');
                            }
                        } catch (error) {
                            console.error('Error removing product:', error);
                            showToast('Error removing product');
                        }
                    }
                });
            }
            
            // Admin add functionality
            const add = slide.querySelector('[data-add]');
            if (add) {
                add.addEventListener('click', () => {
                    // Redirect to admin dashboard for proper product creation
                    window.location.href = 'admin-dashboard.html#product-management';
                });
            }
        });
    }
    // Also add this check for the "View Full Cart" link:
document.querySelector('.btn-view-cart').addEventListener('click', function(e) {
    const cart = getCart();
    if (cart.length === 0) {
        e.preventDefault();
        showToast('Your cart is empty!');
        return;
    }
    
    // Check if user is logged in
    if (!requireAuth('cart')) {
        e.preventDefault();
        // Save cart temporarily
        localStorage.setItem('pendingCart', JSON.stringify(cart));
        showToast('Please login or register to view your cart');
    }
});

    // Slider navigation
    const dotsWrap = document.getElementById('dots');
    const prev = document.querySelector('.prev');
    const next = document.querySelector('.next');
    let index = 0;
    
    function renderDots() {
        const track = document.getElementById('track');
        const slides = Array.from(track.children);
        dotsWrap.innerHTML = '';
        
        slides.forEach((_, i) => {
            const dot = document.createElement('button');
            dot.className = 'dot' + (i === index ? ' active' : '');
            dot.addEventListener('click', () => go(i));
            dotsWrap.appendChild(dot);
        });
    }
    
    function go(i) {
        const track = document.getElementById('track');
        const slides = Array.from(track.children);
        index = (i + slides.length) % slides.length;
        track.style.transform = `translateX(${-100 * index}%)`;
        renderDots();
    }
    
    prev.addEventListener('click', () => go(index - 1));
    next.addEventListener('click', () => go(index + 1));
    
    // Auto-slide only if there are multiple products
    let slideInterval;
    function startAutoSlide() {
        const track = document.getElementById('track');
        const slides = Array.from(track.children);
        if (slides.length > 1) {
            slideInterval = setInterval(() => go(index + 1), 7000);
        }
    }
    
    // Touch swipe support
    let startX = null;
    const trackEl = document.getElementById('track');
    
    trackEl.addEventListener('touchstart', (e) => { 
        startX = e.touches[0].clientX; 
        clearInterval(slideInterval);
    }, { passive: true });
    
    trackEl.addEventListener('touchmove', (e) => {
        if (startX === null) return;
        const dx = e.touches[0].clientX - startX;
        if (Math.abs(dx) > 60) {
            go(index + (dx < 0 ? 1 : -1));
            startX = null;
        }
    }, { passive: true });
    
    trackEl.addEventListener('touchend', () => { 
        startX = null;
        startAutoSlide();
    });

    // Toast notification
    const toast = document.getElementById('toast');
    function showToast(msg) {
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 1800);
    }

    // Image error handler
    function handleImageError(img) {
        console.error('üñºÔ∏è Image failed to load:', img.src);
        img.style.display = 'none';
        const placeholder = img.nextElementSibling;
        if (placeholder && placeholder.classList.contains('image-placeholder')) {
            placeholder.style.display = 'flex';
        }
    }
    
    // API test function
    async function testProductsAPI() {
        try {
            console.log('üß™ Testing products API...');
            
            const response = await fetch('https://princess-sultana-beauty-shop-online.onrender.com/api/products');
            console.log('Response status:', response.status);
            console.log('Response headers:', response.headers);
            
            const text = await response.text();
            console.log('Response text:', text);
            
            try {
                const products = JSON.parse(text);
                console.log('Parsed products:', products);
            } catch (parseError) {
                console.error('Failed to parse JSON:', parseError);
            }
        } catch (error) {
            console.error('Test failed:', error);
        }
    }

    // Initialize the shop
    document.addEventListener('DOMContentLoaded', () => {
        renderProducts().then(startAutoSlide);
        updateCartCount();
    });
</script>
</body>
</html>